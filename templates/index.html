<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LED Matrix Config</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .tabs {
            display: flex;
            flex-wrap: wrap;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
            padding: 0;
            margin: 0;
        }
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            background: #f5f5f5;
            border: none;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
            color: #666;
        }
        .tab:hover {
            background: #e0e0e0;
            color: #333;
        }
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom-color: #667eea;
        }
        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s ease;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .section {
            background: #f9f9f9;
            padding: 25px;
            margin-bottom: 25px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        .section h3 {
            margin-top: 0;
            color: #667eea;
            font-size: 1.3em;
            font-weight: 500;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        input[type="text"],
        input[type="number"],
        input[type="password"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        button:active {
            transform: translateY(0);
        }
        .success-message {
            background: #4caf50;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            animation: slideIn 0.3s ease;
        }
        .error-message {
            background: #f44336;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 6px;
        }
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 6px;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-active { background-color: #4caf50; }
        .status-inactive { background-color: #f44336; }
        .status-unknown { background-color: #9e9e9e; }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .button-secondary {
            background: #6c757d;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.4);
        }
        .button-test {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
        }
        .test-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            display: none;
        }
        .test-success {
            background: #e8f5e9;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }
        .test-error {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ LED Matrix Configuration</h1>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="openTab('display')">Display Settings</button>
            <button class="tab" onclick="openTab('wifi')">WiFi Config</button>
            <button class="tab" onclick="openTab('weather')">Weather</button>
            <button class="tab" onclick="openTab('teams')">Sports Teams</button>
            <button class="tab" onclick="openTab('stocks')">Stocks & Crypto</button>
            <button class="tab" onclick="openTab('flights')">Flights ‚úàÔ∏è</button>
            <button class="tab" onclick="openTab('features')">Additional Features</button>
            <button class="tab" onclick="openTab('news')">News Manager</button>
            <button class="tab" onclick="openTab('sports-rotations')">Sports Rotations</button>
            <button class="tab" onclick="openTab('nba')">NBA</button>
            <button class="tab" onclick="openTab('nfl')">NFL</button>
            <button class="tab" onclick="openTab('nhl')">NHL</button>
            <button class="tab" onclick="openTab('advanced')">Advanced</button>
        </div>

        <!-- Display Settings Tab -->
        <div id="display" class="tab-content active">
            <div class="success-message" id="display-success">Settings saved successfully!</div>
            <div class="error-message" id="display-error">Error saving settings</div>
            
            <div class="section">
                <h3>‚öôÔ∏è Display Configuration</h3>
                <form id="displayForm">
                    <div class="grid">
                        <div class="form-group">
                            <label>Brightness (0-100)</label>
                            <input type="number" name="brightness" min="0" max="100" value="50">
                        </div>
                        <div class="form-group">
                            <label>Update Interval (seconds)</label>
                            <input type="number" name="update_interval" min="1" value="30">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" name="auto_brightness" id="auto_brightness">
                            <label for="auto_brightness" style="margin: 0;">Enable Auto Brightness</label>
                        </div>
                    </div>
                    <button type="submit">Save Display Settings</button>
                </form>
            </div>
        </div>

        <!-- WiFi Config Tab -->
        <div id="wifi" class="tab-content">
            <div class="success-message" id="wifi-success">WiFi settings saved!</div>
            <div class="error-message" id="wifi-error">Error saving WiFi settings</div>
            
            <div class="section">
                <h3>üì° WiFi Configuration</h3>
                <div class="info-box">
                    <strong>Note:</strong> Changing WiFi settings will restart the network connection.
                </div>
                <form id="wifiForm">
                    <div class="form-group">
                        <label>Network Name (SSID)</label>
                        <input type="text" name="ssid" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" name="password">
                    </div>
                    <button type="submit">Update WiFi</button>
                </form>
            </div>
        </div>

        <!-- Weather Tab -->
        <div id="weather" class="tab-content">
            <div class="success-message" id="weather-success">Weather settings saved!</div>
            <div class="error-message" id="weather-error">Error saving weather settings</div>
            
            <div class="section">
                <h3>üå§Ô∏è Weather Configuration</h3>
                <form id="weatherForm">
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="text" name="api_key" placeholder="Enter your weather API key">
                    </div>
                    <div class="grid">
                        <div class="form-group">
                            <label>City</label>
                            <input type="text" name="city" value="Waukee">
                        </div>
                        <div class="form-group">
                            <label>State</label>
                            <input type="text" name="state" value="Iowa">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" name="show_forecast" id="show_forecast" checked>
                            <label for="show_forecast" style="margin: 0;">Show Forecast</label>
                        </div>
                    </div>
                    <button type="submit">Save Weather Settings</button>
                </form>
            </div>
        </div>

        <!-- Sports Teams Tab -->
        <div id="teams" class="tab-content">
            <div class="success-message" id="teams-success">Teams updated!</div>
            <div class="error-message" id="teams-error">Error updating teams</div>
            
            <div class="section">
                <h3>üèÜ Favorite Sports Teams</h3>
                <div class="info-box">
                    Select your favorite teams to track their scores and schedules.
                </div>
                <form id="teamsForm">
                    <div class="form-group">
                        <label>NFL Team</label>
                        <select name="nfl_team">
                            <option value="">Select Team</option>
                            <option value="KC">Kansas City Chiefs</option>
                            <option value="GB">Green Bay Packers</option>
                            <option value="NE">New England Patriots</option>
                            <!-- Add more teams -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>NBA Team</label>
                        <select name="nba_team">
                            <option value="">Select Team</option>
                            <option value="LAL">Los Angeles Lakers</option>
                            <option value="GSW">Golden State Warriors</option>
                            <option value="CHI">Chicago Bulls</option>
                            <!-- Add more teams -->
                        </select>
                    </div>
                    <button type="submit">Save Teams</button>
                </form>
            </div>
        </div>

        <!-- Stocks & Crypto Tab -->
        <div id="stocks" class="tab-content">
            <div class="success-message" id="stocks-success">Stock settings saved!</div>
            <div class="error-message" id="stocks-error">Error saving settings</div>
            
            <div class="section">
                <h3>üìà Stocks & Crypto Tracker</h3>
                <form id="stocksForm">
                    <div class="form-group">
                        <label>Stock Symbols (comma separated)</label>
                        <input type="text" name="stock_symbols" placeholder="AAPL, GOOGL, TSLA">
                    </div>
                    <div class="form-group">
                        <label>Crypto Symbols (comma separated)</label>
                        <input type="text" name="crypto_symbols" placeholder="BTC, ETH, SOL">
                    </div>
                    <div class="grid">
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" name="show_stocks" id="show_stocks" checked>
                                <label for="show_stocks" style="margin: 0;">Show Stocks</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" name="show_crypto" id="show_crypto" checked>
                                <label for="show_crypto" style="margin: 0;">Show Crypto</label>
                            </div>
                        </div>
                    </div>
                    <button type="submit">Save Stock Settings</button>
                </form>
            </div>
        </div>

        <!-- Flights Tab -->
        <div id="flights" class="tab-content">
            <div class="success-message" id="flights-success">Flight settings saved successfully!</div>
            <div class="error-message" id="flights-error">Error saving flight settings</div>
            
            <div class="section">
                <h3>‚úàÔ∏è Flight Tracker Configuration</h3>
                
                <div class="info-box">
                    <strong>OpenSky Network OAuth Setup:</strong><br>
                    1. Visit <a href="https://opensky-network.org/" target="_blank">OpenSky Network</a><br>
                    2. Create an account or log in<br>
                    3. Go to OAuth Settings in your account<br>
                    4. Create new OAuth credentials<br>
                    5. Copy the Client ID and Client Secret below
                </div>

                <form id="flightsForm">
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" name="enabled" id="flights_enabled">
                            <label for="flights_enabled" style="margin: 0;">Enable Flight Tracking</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>OpenSky Client ID</label>
                        <input type="text" name="opensky_client_id" id="opensky_client_id" placeholder="Your OAuth Client ID">
                    </div>

                    <div class="form-group">
                        <label>OpenSky Client Secret</label>
                        <input type="password" name="opensky_client_secret" id="opensky_client_secret" placeholder="Your OAuth Client Secret">
                    </div>

                    <h4 style="color: #667eea; margin-top: 30px;">Location Settings</h4>
                    
                    <div class="grid">
                        <div class="form-group">
                            <label>Home Latitude</label>
                            <input type="number" name="home_lat" id="home_lat" step="0.000001" value="41.6" placeholder="41.6">
                            <small style="color: #666;">Example: 41.6 (Waukee, IA)</small>
                        </div>
                        <div class="form-group">
                            <label>Home Longitude</label>
                            <input type="number" name="home_lon" id="home_lon" step="0.000001" value="-93.6" placeholder="-93.6">
                            <small style="color: #666;">Example: -93.6 (Waukee, IA)</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Search Radius (km)</label>
                        <input type="number" name="radius_km" id="radius_km" min="5" max="250" value="50">
                        <small style="color: #666;">How far to look for flights (5-250 km)</small>
                    </div>

                    <h4 style="color: #667eea; margin-top: 30px;">Display Settings</h4>
                    
                    <div class="grid">
                        <div class="form-group">
                            <label>Max Flights to Show</label>
                            <input type="number" name="max_flights" id="max_flights" min="1" max="20" value="10">
                        </div>
                        <div class="form-group">
                            <label>Min Altitude (meters)</label>
                            <input type="number" name="min_altitude_m" id="min_altitude_m" min="0" value="500">
                            <small style="color: #666;">Filter out ground traffic</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Update Interval (seconds)</label>
                        <input type="number" name="update_interval" id="update_interval" min="10" max="300" value="30">
                        <small style="color: #666;">How often to check for new flights</small>
                    </div>

                    <h4 style="color: #667eea; margin-top: 30px;">Active Hours</h4>
                    <div class="info-box">
                        Flight tracking will only be active during these hours to save API calls.
                    </div>
                    
                    <div class="grid">
                        <div class="form-group">
                            <label>Start Hour (0-23)</label>
                            <input type="number" name="start_hour" id="start_hour" min="0" max="23" value="6">
                            <small style="color: #666;">Hour to start tracking (24-hour format)</small>
                        </div>
                        <div class="form-group">
                            <label>End Hour (0-23)</label>
                            <input type="number" name="end_hour" id="end_hour" min="0" max="23" value="23">
                            <small style="color: #666;">Hour to stop tracking (24-hour format)</small>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="submit">Save Flight Settings</button>
                        <button type="button" class="button-test" onclick="testFlightConnection()">Test Connection</button>
                    </div>

                    <div id="flight-test-result" class="test-result"></div>
                </form>
            </div>

            <div class="section">
                <h3>üìä Flight Tracker Status</h3>
                <div id="flight-status">
                    <p>Loading status...</p>
                </div>
                <button onclick="loadFlightStatus()">Refresh Status</button>
            </div>
        </div>

        <!-- Additional Features Tab -->
        <div id="features" class="tab-content">
            <div class="success-message" id="features-success">Settings saved!</div>
            <div class="error-message" id="features-error">Error saving settings</div>
            
            <div class="section">
                <h3>üéØ Additional Features</h3>
                <form id="featuresForm">
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" name="show_clock" id="show_clock" checked>
                            <label for="show_clock" style="margin: 0;">Show Clock</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" name="show_date" id="show_date" checked>
                            <label for="show_date" style="margin: 0;">Show Date</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" name="screensaver" id="screensaver">
                            <label for="screensaver" style="margin: 0;">Enable Screensaver Mode</label>
                        </div>
                    </div>
                    <button type="submit">Save Feature Settings</button>
                </form>
            </div>
        </div>

        <!-- News Manager Tab -->
        <div id="news" class="tab-content">
            <div class="success-message" id="news-success">News settings saved!</div>
            <div class="error-message" id="news-error">Error saving news settings</div>
            
            <div class="section">
                <h3>üì∞ News Manager</h3>
                <form id="newsForm">
                    <div class="form-group">
                        <label>News API Key</label>
                        <input type="text" name="news_api_key" placeholder="Enter your news API key">
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" name="show_news" id="show_news" checked>
                            <label for="show_news" style="margin: 0;">Show News Headlines</label>
                        </div>
                    </div>
                    <button type="submit">Save News Settings</button>
                </form>
            </div>
        </div>

        <!-- Sports Rotations Tab -->
        <div id="sports-rotations" class="tab-content">
            <div class="success-message" id="rotations-success">Rotation settings saved!</div>
            <div class="error-message" id="rotations-error">Error saving settings</div>
            
            <div class="section">
                <h3>üîÑ Sports Display Rotations</h3>
                <div class="info-box">
                    Configure how sports scores rotate on the display.
                </div>
                <form id="rotationsForm">
                    <div class="form-group">
                        <label>Display Duration (seconds)</label>
                        <input type="number" name="rotation_duration" min="5" max="60" value="10">
                    </div>
                    <button type="submit">Save Rotation Settings</button>
                </form>
            </div>
        </div>

        <!-- NBA Tab -->
        <div id="nba" class="tab-content">
            <div class="success-message" id="nba-success">NBA settings saved!</div>
            <div class="error-message" id="nba-error">Error saving settings</div>
            
            <div class="section">
                <h3>üèÄ NBA Configuration</h3>
                <form id="nbaForm">
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" name="show_nba" id="show_nba" checked>
                            <label for="show_nba" style="margin: 0;">Show NBA Scores</label>
                        </div>
                    </div>
                    <button type="submit">Save NBA Settings</button>
                </form>
            </div>
        </div>

        <!-- NFL Tab -->
        <div id="nfl" class="tab-content">
            <div class="success-message" id="nfl-success">NFL settings saved!</div>
            <div class="error-message" id="nfl-error">Error saving settings</div>
            
            <div class="section">
                <h3>üèà NFL Configuration</h3>
                <form id="nflForm">
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" name="show_nfl" id="show_nfl" checked>
                            <label for="show_nfl" style="margin: 0;">Show NFL Scores</label>
                        </div>
                    </div>
                    <button type="submit">Save NFL Settings</button>
                </form>
            </div>
        </div>

        <!-- NHL Tab -->
        <div id="nhl" class="tab-content">
            <div class="success-message" id="nhl-success">NHL settings saved!</div>
            <div class="error-message" id="nhl-error">Error saving settings</div>
            
            <div class="section">
                <h3>üèí NHL Configuration</h3>
                <form id="nhlForm">
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" name="show_nhl" id="show_nhl" checked>
                            <label for="show_nhl" style="margin: 0;">Show NHL Scores</label>
                        </div>
                    </div>
                    <button type="submit">Save NHL Settings</button>
                </form>
            </div>
        </div>

        <!-- Advanced Tab -->
        <div id="advanced" class="tab-content">
            <div class="success-message" id="advanced-success">Advanced settings saved!</div>
            <div class="error-message" id="advanced-error">Error saving settings</div>
            
            <div class="section">
                <h3>‚öôÔ∏è Advanced Settings</h3>
                <div class="warning-box">
                    <strong>Warning:</strong> These settings are for advanced users only.
                </div>
                <form id="advancedForm">
                    <div class="form-group">
                        <label>Debug Mode</label>
                        <div class="checkbox-group">
                            <input type="checkbox" name="debug_mode" id="debug_mode">
                            <label for="debug_mode" style="margin: 0;">Enable Debug Logging</label>
                        </div>
                    </div>
                    <button type="submit">Save Advanced Settings</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        function openTab(tabName) {
            const contents = document.getElementsByClassName('tab-content');
            const tabs = document.getElementsByClassName('tab');
            
            for (let content of contents) {
                content.classList.remove('active');
            }
            for (let tab of tabs) {
                tab.classList.remove('active');
            }
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Load flight status when opening flights tab
            if (tabName === 'flights') {
                loadFlightConfig();
                loadFlightStatus();
            }
        }

        // Show message helper
        function showMessage(elementId, duration = 3000) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, duration);
        }

        // Generic form submission
        function setupFormHandler(formId, endpoint, successMsgId, errorMsgId) {
            const form = document.getElementById(formId);
            if (!form) return;
            
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);
                
                try {
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    
                    if (response.ok) {
                        showMessage(successMsgId);
                    } else {
                        showMessage(errorMsgId);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showMessage(errorMsgId);
                }
            });
        }

        // Flight-specific functions
        async function loadFlightConfig() {
            try {
                const response = await fetch('/api/flight-config');
                if (!response.ok) throw new Error('Failed to load config');
                
                const config = await response.json();
                
                // Populate form fields
                document.getElementById('flights_enabled').checked = config.enabled || false;
                document.getElementById('opensky_client_id').value = config.opensky_client_id || '';
                document.getElementById('opensky_client_secret').value = config.opensky_client_secret || '';
                document.getElementById('home_lat').value = config.home_lat || 41.6;
                document.getElementById('home_lon').value = config.home_lon || -93.6;
                document.getElementById('radius_km').value = config.radius_km || 50;
                document.getElementById('max_flights').value = config.max_flights || 10;
                document.getElementById('min_altitude_m').value = config.min_altitude_m || 500;
                document.getElementById('update_interval').value = config.update_interval || 30;
                document.getElementById('start_hour').value = config.start_hour || 6;
                document.getElementById('end_hour').value = config.end_hour || 23;
            } catch (error) {
                console.error('Error loading flight config:', error);
            }
        }

        async function loadFlightStatus() {
            const statusDiv = document.getElementById('flight-status');
            try {
                const response = await fetch('/api/flight-status');
                if (!response.ok) throw new Error('Failed to load status');
                
                const status = await response.json();
                
                const enabledClass = status.enabled ? 'status-active' : 'status-inactive';
                const enabledText = status.enabled ? 'Enabled' : 'Disabled';
                
                const activeClass = status.polling_window?.currently_active ? 'status-active' : 'status-inactive';
                const activeText = status.polling_window?.currently_active ? 'Active' : 'Inactive';
                
                statusDiv.innerHTML = `
                    <p><span class="status-indicator ${enabledClass}"></span><strong>Status:</strong> ${enabledText}</p>
                    <p><span class="status-indicator ${activeClass}"></span><strong>Polling:</strong> ${activeText}</p>
                    <p><strong>Home Location:</strong> ${status.home_location?.latitude?.toFixed(2) || 'N/A'}, ${status.home_location?.longitude?.toFixed(2) || 'N/A'}</p>
                    <p><strong>Search Radius:</strong> ${status.radius_km || 'N/A'} km</p>
                    <p><strong>Active Hours:</strong> ${status.polling_window?.start_hour || 'N/A'}:00 - ${status.polling_window?.end_hour || 'N/A'}:00</p>
                    <p><strong>Flights Visible:</strong> ${status.flights_visible || 0}</p>
                    <p><strong>Auth Status:</strong> ${status.auth_status || 'unknown'}</p>
                `;
            } catch (error) {
                console.error('Error loading flight status:', error);
                statusDiv.innerHTML = '<p style="color: #f44336;">Error loading status</p>';
            }
        }

        async function testFlightConnection() {
            const resultDiv = document.getElementById('flight-test-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result';
            resultDiv.innerHTML = '‚è≥ Testing connection...';
            
            try {
                const response = await fetch('/api/flight-test');
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.className = 'test-result test-success';
                    resultDiv.innerHTML = `‚úÖ ${result.message}<br>Found ${result.flight_count} flights in your area!`;
                } else {
                    resultDiv.className = 'test-result test-error';
                    resultDiv.innerHTML = `‚ùå Connection failed: ${result.error}`;
                }
            } catch (error) {
                resultDiv.className = 'test-result test-error';
                resultDiv.innerHTML = `‚ùå Test failed: ${error.message}`;
            }
        }

        // Setup form handlers
        document.addEventListener('DOMContentLoaded', () => {
            setupFormHandler('displayForm', '/api/display-config', 'display-success', 'display-error');
            setupFormHandler('wifiForm', '/api/wifi-config', 'wifi-success', 'wifi-error');
            setupFormHandler('weatherForm', '/api/weather-config', 'weather-success', 'weather-error');
            setupFormHandler('teamsForm', '/api/teams-config', 'teams-success', 'teams-error');
            setupFormHandler('stocksForm', '/api/stocks-config', 'stocks-success', 'stocks-error');
            setupFormHandler('featuresForm', '/api/features-config', 'features-success', 'features-error');
            setupFormHandler('newsForm', '/api/news-config', 'news-success', 'news-error');
            setupFormHandler('rotationsForm', '/api/rotations-config', 'rotations-success', 'rotations-error');
            setupFormHandler('nbaForm', '/api/nba-config', 'nba-success', 'nba-error');
            setupFormHandler('nflForm', '/api/nfl-config', 'nfl-success', 'nfl-error');
            setupFormHandler('nhlForm', '/api/nhl-config', 'nhl-success', 'nhl-error');
            setupFormHandler('advancedForm', '/api/advanced-config', 'advanced-success', 'advanced-error');

            // Flight form handler (custom because it needs special handling)
            const flightsForm = document.getElementById('flightsForm');
            flightsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = {
                    enabled: document.getElementById('flights_enabled').checked,
                    opensky_client_id: document.getElementById('opensky_client_id').value,
                    opensky_client_secret: document.getElementById('opensky_client_secret').value,
                    home_lat: parseFloat(document.getElementById('home_lat').value),
                    home_lon: parseFloat(document.getElementById('home_lon').value),
                    radius_km: parseInt(document.getElementById('radius_km').value),
                    max_flights: parseInt(document.getElementById('max_flights').value),
                    min_altitude_m: parseInt(document.getElementById('min_altitude_m').value),
                    update_interval: parseInt(document.getElementById('update_interval').value),
                    start_hour: parseInt(document.getElementById('start_hour').value),
                    end_hour: parseInt(document.getElementById('end_hour').value)
                };
                
                try {
                    const response = await fetch('/api/flight-config', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    if (response.ok) {
                        showMessage('flights-success');
                        loadFlightStatus();
                    } else {
                        const error = await response.json();
                        document.getElementById('flights-error').textContent = 
                            'Error: ' + (error.message || 'Failed to save settings');
                        showMessage('flights-error');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    document.getElementById('flights-error').textContent = 
                        'Error: ' + error.message;
                    showMessage('flights-error');
                }
            });
        });
    </script>
</body>
</html>
